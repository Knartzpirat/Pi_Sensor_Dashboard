# Internationalization (i18n) Documentation

## Overview

The Pi Sensor Dashboard supports multiple languages through `next-intl`. Currently, two languages are fully supported:
- **English (en)** - 591 translation keys
- **German (de)** - 568 translation keys

## Translation Files

Translation files are located in the [`messages/`](messages/) directory:
- [`messages/en.json`](messages/en.json) - English translations
- [`messages/de.json`](messages/de.json) - German translations (Deutsch)

## Translation Structure

Translations are organized into logical namespaces:

### Core Namespaces

#### `homepage`
Homepage content and welcome messages

#### `dashboard`
Main dashboard interface translations including:
- Real-time sensor monitoring
- Active measurements display
- Completed measurements
- Sensor controls

#### `sidebar`
Application navigation and menu items

#### `measurements`
Measurement configuration and management:
- Starting new measurements
- Measurement parameters (duration, interval)
- Sensor selection
- Validation messages

#### `measurementsPage`
Measurements overview page:
- Table columns
- Status labels
- Detailed view
- Analysis tools

#### `sensors`
Sensor management:
- Adding/editing sensors
- Connection types (I2C, ADC, GPIO)
- Pin/channel selection
- Configuration warnings

#### `testObjects`
Test object management:
- Creating and editing test objects
- File uploads (images, PDFs)
- Table view
- Deletion dialogs

#### `settings`
Application settings:
- Account management
- User preferences
- Hardware configuration
- Date formats and timezones

### UI Element Namespaces

#### `common`
Common UI strings used throughout the application

#### `buttons`
Button labels and actions

#### `table`
Data table interface elements

#### `filters`
Data filtering interface

#### `operators`
Filter operators (contains, is, greater than, etc.)

#### `sort`
Sorting options

#### `deleteDialog`
Confirmation dialogs for deletions

#### `loading`
Loading states and progress indicators

### Form Namespaces

#### `inputs`
Form input labels

#### `validation`
Form validation error messages

#### `errors`
General error messages

#### `success`
Success notifications

### Authentication Namespaces

#### `setup`
Initial setup wizard

#### `login`
Login page

#### `forgotPassword`
Password recovery

#### `resetPassword`
Password reset

## Usage in Components

### Server Components

```typescript
import { getTranslations } from 'next-intl/server';

export default async function MyPage() {
  const t = await getTranslations('measurements');

  return (
    <div>
      <h1>{t('title')}</h1>
      <p>{t('description')}</p>
    </div>
  );
}
```

### Client Components

```typescript
'use client';

import { useTranslations } from 'next-intl';

export function MyComponent() {
  const t = useTranslations('dashboard');

  return (
    <button>{t('measurement.cancel')}</button>
  );
}
```

### Using Multiple Namespaces

```typescript
export function ComplexComponent() {
  const tDashboard = useTranslations('dashboard');
  const tCommon = useTranslations('common');
  const tButtons = useTranslations('buttons');

  return (
    <div>
      <h2>{tDashboard('title')}</h2>
      <button>{tButtons('save')}</button>
      <span>{tCommon('loading')}</span>
    </div>
  );
}
```

### Pluralization

```typescript
const t = useTranslations('table');

// Displays: "0 rows selected" or "1 row selected" or "5 rows selected"
<span>{t('selectionInfo', { selectedCount: 5, totalCount: 100 })}</span>
```

### Interpolation

```typescript
const t = useTranslations('common');

// Displays: "Redirecting in 5 seconds..."
<span>{t('redirectingIn', { seconds: 5 })}</span>
```

## Language Switching

Language preference is stored in a cookie and can be changed via:

1. **Language Selector** in settings
2. **Programmatic Switch:**

```typescript
import { useLocale } from 'next-intl';
import { useRouter, usePathname } from 'next/navigation';

function LanguageSwitcher() {
  const locale = useLocale();
  const router = useRouter();
  const pathname = usePathname();

  const switchLanguage = (newLocale: string) => {
    const newPath = pathname.replace(`/${locale}`, `/${newLocale}`);
    router.push(newPath);
  };

  return (
    <select value={locale} onChange={(e) => switchLanguage(e.target.value)}>
      <option value="en">English</option>
      <option value="de">Deutsch</option>
    </select>
  );
}
```

## Adding New Translations

### 1. Add Translation Keys

Add the translation key to **both** `en.json` and `de.json`:

**messages/en.json:**
```json
{
  "myFeature": {
    "title": "My Feature",
    "description": "This is my new feature"
  }
}
```

**messages/de.json:**
```json
{
  "myFeature": {
    "title": "Meine Funktion",
    "description": "Dies ist meine neue Funktion"
  }
}
```

### 2. Use in Components

```typescript
const t = useTranslations('myFeature');
return <h1>{t('title')}</h1>;
```

## Translation Keys Reference

### Complete Key Count by Namespace

| Namespace | Keys | Description |
|-----------|------|-------------|
| `homepage` | 2 | Welcome page content |
| `dashboard` | 27 | Main dashboard interface |
| `sidebar` | 9 | Navigation menu |
| `measurements` | 27 | Measurement configuration |
| `measurementsPage` | 41 | Measurements page and analysis |
| `sensors` | 25 | Sensor management |
| `testObjects` | 35 | Test object management |
| `settings` | 45 | Application settings |
| `common` | 13 | Common UI strings |
| `buttons` | 14 | Button labels |
| `table` | 24 | Table interface |
| `filters` | 10 | Filter interface |
| `operators` | 14 | Filter operators |
| `sort` | 2 | Sorting options |
| `deleteDialog` | 4 | Deletion confirmations |
| `loading` | 1 | Loading states |
| `inputs` | 9 | Form inputs |
| `validation` | 18 | Validation messages |
| `errors` | 8 | Error messages |
| `success` | 2 | Success notifications |
| `setup` | 12 | Setup wizard |
| `login` | 7 | Login page |
| `forgotPassword` | 4 | Password recovery |
| `resetPassword` | 6 | Password reset |
| `language` | 2 | Language names |
| `FeatureFlags` | 6 | Feature flags UI |

## Common Patterns

### Nested Keys

Access nested translations with dot notation:

```typescript
t('dashboard.measurement.cancel')
t('settings.account.password')
t('measurementsPage.analysis.statistics')
```

### Dynamic Keys

```typescript
// Status translations
const status = 'running';
<span>{t(`measurementsPage.status.${status}`)}</span>
// Displays: "Running" (EN) or "Läuft" (DE)
```

### Rich Text

```typescript
// Using HTML in translations
t.rich('description', {
  strong: (chunks) => <strong>{chunks}</strong>,
  link: (chunks) => <a href="/help">{chunks}</a>
})
```

## Best Practices

### 1. Keep Keys Organized

Group related translations under the same namespace:

```json
{
  "sensors": {
    "addSensor": "...",
    "editSensor": "...",
    "connectionTypes": {
      "i2c": "...",
      "adc": "..."
    }
  }
}
```

### 2. Use Descriptive Keys

```json
// ✅ Good
"measurementTitle": "Measurement Title"

// ❌ Bad
"title1": "Measurement Title"
```

### 3. Avoid Hardcoded Text

```typescript
// ❌ Bad
<button>Save</button>

// ✅ Good
const t = useTranslations('common');
<button>{t('save')}</button>
```

### 4. Use Pluralization

```json
{
  "selectionInfo": "{selectedCount, plural, =0 {No rows selected} one {{selectedCount} of {totalCount} row selected} other {{selectedCount} of {totalCount} rows selected}}"
}
```

### 5. Keep Translations Synchronized

Always add translations to **both** language files when adding new keys.

## Validation

### Check for Missing Keys

```bash
# Count keys in each file
grep -o '"[^"]*":' messages/en.json | wc -l
grep -o '"[^"]*":' messages/de.json | wc -l

# Find keys in EN not in DE
diff <(grep -o '"[^"]*":' messages/en.json | sort) <(grep -o '"[^"]*":' messages/de.json | sort)
```

### Type Safety

TypeScript provides type checking for translation keys when using `next-intl`:

```typescript
// TypeScript will warn if 'invalidKey' doesn't exist
t('invalidKey') // ❌ Type error

// Valid key
t('dashboard.title') // ✅ OK
```

## Configuration

Translation configuration is in [`i18n.ts`](i18n.ts):

```typescript
import { getRequestConfig } from 'next-intl/server';

export default getRequestConfig(async ({ locale }) => ({
  messages: (await import(`./messages/${locale}.json`)).default
}));
```

## Troubleshooting

### Translation Not Appearing

1. **Check namespace**: Ensure you're using the correct namespace in `useTranslations()`
2. **Check key path**: Verify the full path to the translation key
3. **Check file**: Ensure the key exists in the translation file
4. **Restart dev server**: Changes to translation files may require restart

### Fallback Behavior

If a translation key is missing:
- In development: Shows the key path (e.g., `dashboard.missing.key`)
- In production: Shows empty string or fallback value

### Formatting Issues

Ensure JSON syntax is correct:
```bash
# Validate JSON
node -e "JSON.parse(require('fs').readFileSync('messages/en.json', 'utf8'))"
```

## Migration Notes

### Problem #11 Resolution

**Original Issue:**
- English translations: 314 lines (incomplete)
- German translations: 569 lines (complete)
- Missing sidebar translations in English
- Inconsistent coverage between languages

**Solution:**
- Added all missing English translations
- Result: 591 lines (EN), 568 lines (DE)
- Both languages now have complete coverage
- All namespaces fully translated

**Added to English:**
- `sidebar` namespace (9 keys)
- `dashboard.completedMeasurement` (11 keys)
- `deleteDialog` (4 keys)
- Extended `validation` rules (9 additional keys)
- `operators` namespace (14 keys)
- `sort` namespace (2 keys)
- `loading` namespace (1 key)
- Extended `testObjects` (24 additional keys)
- `measurementsPage.detail` and `measurementsPage.analysis` (24 keys)
- Additional `buttons` entries (3 keys)
- Extended `setup.recoverycode` (6 keys)
- Extended `login` and `resetPassword` (4 keys)
- `table` namespace extensions (14 keys)
- `filters` namespace (10 keys)
- `FeatureFlags` namespace (6 keys)

## See Also

- [next-intl Documentation](https://next-intl-docs.vercel.app/)
- [`messages/en.json`](messages/en.json) - English translations
- [`messages/de.json`](messages/de.json) - German translations
- [`MIGRATION_SUMMARY.md`](MIGRATION_SUMMARY.md) - Overall migration status
